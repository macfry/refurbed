<template>
  <main>
    <header class="bg-blue-500 p-4">
      <select-market :options="state.marketOptions" :default="state.selectedMarket" v-model="state.selectedMarket" />

      <img
        class="w-32"
        src="data:image/svg+xml;base64,PHN2ZwogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICBmaWxsLXJ1bGU9ImV2ZW5vZGQiCiAgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIKICBzdHJva2UtbWl0ZXJsaW1pdD0iMiIKICBjbGlwLXJ1bGU9ImV2ZW5vZGQiCiAgdmlld0JveD0iMCAwIDE2MTAgNDIyIgo+PGcgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aAogICAgICBmaWxsPSJ1cmwoI19MaW5lYXIxKSIKICAgICAgZD0iTTU2Ni4yOSA0NDcuNjdhMjcwLjg0NiAyNzAuODQ2IDAgMDAtNy40LTQzLjg2Yy0xLjExLTItMi4zMS00LTMuNTMtNmEyNzMuMjMgMjczLjIzIDAgMDAtMzQuNjUtMjguNjYgMjc3LjAxIDI3Ny4wMSAwIDAwLTEwNS4yNi00NC44NyAyODAuNzMxIDI4MC43MzEgMCAwMC00OC42Ny01LjJjLTEuNzggMC0zLjU5LS4wNi01LjQtLjA2LTEuODEgMC0zLjYyIDAtNS40LjA2IDEuODQuNzggMy42MiAxLjYxIDUuNCAyLjQ4YTE2My45NTUgMTYzLjk1NSAwIDAxMTYuNDIgOS4xYzQ0LjE2IDI3LjY2MSA3Mi45MDMgNzQuNDczIDc3LjU5IDEyNi4zNy4wNi44MS4xNCAxLjYyLjE5IDIuNDJ2LjQ1Yy4wNi42OS4xMSAxLjQyLjE0IDIuMTEuMjIgMy4zNC4zMSA2LjcxLjMxIDEwLjExYTE2NS43MzggMTY1LjczOCAwIDAxLTEyLjggNjQuMTRjMCAuMTEtLjA5LjItLjExLjMxYTE2My45NDIgMTYzLjk0MiAwIDAxLTguMzMgMTcuMDZjLS4zMy41OC0uNjYgMS4xNy0xIDEuNzMtLjM0LjU2LS41My45NC0uODMgMS40MS0xNC45NjIgMjUuMDEtNDEuOTk2IDQwLjQyLTcxLjE0IDQwLjU1aC0uOTRjLTI5LjE0NC0uMTMtNTYuMTc4LTE1LjU0LTcxLjE0LTQwLjU1YTE2Ny4xMjkgMTY3LjEyOSAwIDAwNjMuNDYgNjEuNjVjMi4zNiAxLjE5IDQuNzYgMi4zMSA3LjE4IDMuMzQuNDg5LjI0NS45ODkuNDY1IDEuNS42NiAzLjk1IDEuNjcgOCAzLjIxIDEyLjExIDQuNTRhMTU3LjA0OCAxNTcuMDQ4IDAgMDA0OC42NyA3LjcxIDE1NS4xNSAxNTUuMTUgMCAwMDg0LjgtMjVjMS4xOS0uNzUgMi4zNi0xLjUgMy41My0yLjMxIDEuNzgtMS4yMiAzLjU0LTIuNDggNS4yMy0zLjc2YTE1MC4yNCAxNTAuMjQgMCAwMDEyLTEwYzIuNzktMi41NiA1LjUyLTUuMjMgOC4xLThBMTUyLjg4MiAxNTIuODgyIDAgMDA1NTAgNTY5YTI3Ny4xMzEgMjc3LjEzMSAwIDAwMTcuMzQtOTYuODQgMjYyLjkyIDI2Mi45MiAwIDAwLTEuMDUtMjQuNDl6IgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU1LjQzIC0zMTkuMDIpIgogICAgLz48cGF0aAogICAgICBmaWxsPSJ1cmwoI19MaW5lYXIyKSIKICAgICAgZD0iTTUyNy44OSA2MTBhMTY3LjY5IDE2Ny42OSAwIDAxLTk0LjIxIDI5LjE0IDE2Ni4wODMgMTY2LjA4MyAwIDAxLTcxLjg1LTE2LjIzIDE4LjA1NSAxOC4wNTUgMCAwMC0uODktLjQyYy0uMzQtLjE2LS42Ny0uMzMtMS0uNWExMTkuNSAxMTkuNSAwIDAxLTYuNzMtMy41MyAxNjcuMTI5IDE2Ny4xMjkgMCAwMS02My40Ni02MS42NWMtLjMtLjQ3LS41OC0uOTQtLjgzLTEuNDFzLS42Ny0xLjE1LTEtMS43M2MtMTMuNzM0LTI1LjM0LTEzLjM5Ny01Ni4wNjcuODktODEuMS40MjQtLjgyNS44OTgtMS42MjMgMS40Mi0yLjM5IDE1LjEzNi0yNC43MTQgNDIuMTE5LTM5LjgxOSA3MS4xLTM5LjgtMS42NyAwLTMuMzcgMC01IC4wOS0xLjI1IDAtMi40Ny4wOC0zLjczLjE2aC0uNzdhMTU0Ljg3MyAxNTQuODczIDAgMDAtMjUuODMgMy43OSAxNTIuOTI3IDE1Mi45MjcgMCAwMC0zMS42NCAxMWMtMS4zMS42MS0yLjU5IDEuMjUtMy44NyAxLjg2YTE1Ny41NCAxNTcuNTQgMCAwMC0yMi42MyAxNC4xMWwtLjgzLjY0Yy00NC4xODggMzMuNDgzLTY3LjIxNiA4OC4xODUtNjAuMjggMTQzLjE5LjU4IDQuNTMgMS4zNiA5IDIuMzQgMTMuNDdhMTUxIDE1MSAwIDAwMTAuMyAzMSAyNzguODY3IDI3OC44NjcgMCAwMDk2Ljg0IDc0LjgxIDI3MS41NDQgMjcxLjU0NCAwIDAwNDUuMTcgMTYuNDUgMjcxLjU0NCAyNzEuNTQ0IDAgMDA0NS4xNy0xNi40NSAyNzkuMTgxIDI3OS4xODEgMCAwMDk3LTc0LjkyYzI2LjM4My0zMS44NDkgMCAwIDAtLjA1YTI3Ni40NyAyNzYuNDcgMCAwMDIzLjc2LTMzLjQ2YzEuOTItMy4xNCAzLjc2LTYuMzEgNS41MS05LjU0YTE0MS4zNiAxNDEuMzYgMCAwMS00Ljk1IDMuNDd6IgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU1LjQzIC0zMTkuMDIpIgogICAgLz48cGF0aAogICAgICBmaWxsPSJ1cmwoI19MaW5lYXIzKSIKICAgICAgZD0iTTQ1My42MSA0NjcuNGMtLjItMi41NC0uNDUtNS0uNzgtNy41Mi0uMDgtLjgtLjItMS42MS0uMzEtMi40Mi03LjQ4NS01MS4xNDYtMzkuOTIyLTk1LjM2My04Ni40Ni0xMTcuODYtLjEyIDAtLjItLjExLS4zNC0uMTYtMS43Mi0uODQtMy40Ny0xLjY1LTUuMjYtMi40YTE0OC44MDMgMTQ4LjgwMyAwIDAwLTE2LjExLTYgMTU0LjI3NSAxNTQuMjc1IDAgMDAtMzcuMzUtNi42MyAyNzguNjMgMjc4LjYzIDAgMDAtMTQyLjIxIDc2IDI3MS40OTUgMjcxLjQ5NSAwIDAwLTguMjcgNDcuMjMgMjc4LjAwNyAyNzguMDA3IDAgMDAtMS4wOSAyNC40OSAyNzcuNTM4IDI3Ny41MzggMCAwMDE5LjM3IDEwMi4xNiAyNzEuNTQ3IDI3MS41NDcgMCAwMDE1LjIgMzIuMmMxLjc1IDMuMjMgMy41OSA2LjQgNS41MSA5LjU0LS4yNS0yLS40NS00LS41OC02LS4zMS00LjE4LS40OC04LjQxLS40OC0xMi42N3YtMmMuNjE4LTU0LjIxNyAyNy42MzktMTA0Ljg1OSA3Mi4zMy0xMzUuNTYuMTI1LS4xLjI1NS0uMTkzLjM5LS4yOC4zLS4yMi42NC0uNDQgMS0uNjZsLjkyLS42MmExNjUuODA3IDE2NS44MDcgMCAwMTgyLjc3LTI3LjU1aC43N2MxLjI2LS4wOCAyLjQ4LS4xNCAzLjczLS4xNiAxLjY3LS4wNiAzLjM3LS4wOSA1LS4wOSAyOC45ODMtLjAxNyA1NS45NjggMTUuMDg3IDcxLjExIDM5LjguNTE4Ljc2OS45OTIgMS41NjcgMS40MiAyLjM5IDE0LjI3NCAyNS4wMzYgMTQuNjExIDU1Ljc1Ni44OSA4MS4xLS4zMS41OC0uNjQgMS4xNC0xIDEuNzMuMzQtLjU2LjY3LTEuMTUgMS0xLjczYTE2My45NDIgMTYzLjk0MiAwIDAwOC4zMy0xNy4wNmMwLS4xMS4wOC0uMi4xMS0uMzFhMTUzLjQ5MyAxNTMuNDkzIDAgMDAxMC4zNS00NS4xNnYtLjM3Yy4zMS0zLjc1LjQyLTcuNTQuNDItMTEuMzUuMDA3LTQuMDgtLjEyLTguMTA3LS4zOC0xMi4wOHoiCiAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTUuNDMgLTMxOS4wMikiCiAgICAvPjxwYXRoCiAgICAgIGZpbGw9IiNmZmYiCiAgICAgIGQ9Ik01MTAuMyAxNDcuODloMjd2MjIuMmMxMS4xLTE0LjQgMjguMi0yNS41IDQ3LjQtMjUuNXYyNy4zYTQyLjQ3IDQyLjQ3IDAgMDAtOS4zLS45Yy0xMy41IDAtMzEuOCAxMC4yLTM4LjEgMjF2MTAwLjhoLTI3di0xNDQuOXptMTY1LTMuNmM0My41IDAgNzAuNSAzMy45IDcwLjUgNzguM3Y2LjZINjMxLjJjMi4xIDI0LjYgMjAuMSA0NSA0OS4yIDQ1IDE1LjMgMCAzMi4xLTYgNDIuOS0xNy4xbDEyLjYgMTcuN2MtMTQuNCAxNC4xLTM0LjggMjEuNi01OC4yIDIxLjYtNDMuMiAwLTc1LTMwLjYtNzUtNzYuMiAwLTQyIDMwLjMtNzUuOSA3Mi42LTc1Ljl6bS00NC40IDY1LjRoODguNWMtLjYtMTkuMi0xMy41LTQzLjItNDQuMS00My4yLTI5LjEgMC00Mi45IDIzLjQtNDQuNCA0My4yem0xNTUuNC0zOC4xaC0yNHYtMjMuN2gyNHYtOS42YzAtMzEuMiAxOC4zLTQ4LjYgNDQuMS00OC42IDkuMyAwIDE3LjQgMS44IDIzLjcgNS40bC02LjMgMjAuMWEyNS43NSAyNS43NSAwIDAwLTEyLjktMy4zYy0xMy41IDAtMjEuNiA5LTIxLjYgMjYuNHY5LjZoMjkuNHYyMy43aC0yOS40djEyMS4yaC0yN3YtMTIxLjJ6bTE3OS45OSAxMDEuMzljLTExLjEgMTItMjkuNCAyMy40LTUxLjYgMjMuNC0zMC45IDAtNDYuMi0xNS42LTQ2LjItNDYuMlYxNDcuODloMjd2OTMuM2MwIDI0IDEyIDMxLjIgMzAuNiAzMS4yIDE2LjggMCAzMi4xLTkuNiA0MC4yLTIwLjR2LTEwNC4xaDI3djE0NC45aC0yN3YtMTkuODF6bTY5LjktMTI1LjA5aDI3djIyLjJjMTEuMS0xNC40IDI4LjItMjUuNSA0Ny40LTI1LjV2MjcuM2E0Mi41MTIgNDIuNTEyIDAgMDAtOS4zLS45Yy0xMy41IDAtMzEuOCAxMC4yLTM4LjEgMjF2MTAwLjhoLTI3di0xNDQuOXptMTAxLjM4LTU1LjJoMjd2NzYuMmMxMS40LTE1LjYgMjguNS0yNC42IDQ3LjQtMjQuNiAzNy44IDAgNjQuNSAyOS43IDY0LjUgNzYuMiAwIDQ3LjQtMjcgNzUuOS02NC41IDc1LjktMTkuNSAwLTM2LjYtOS45LTQ3LjQtMjQuM3YyMC43aC0yN1Y5Mi42OXptNjcuMiAxNzkuN2MyNyAwIDQzLjgtMjEuNiA0My44LTUxLjkgMC0zMC4zLTE2LjgtNTIuMi00My44LTUyLjItMTYuNSAwLTMzIDkuOS00MC4yIDIxLjZ2NjEuNWM3LjIyIDExLjcgMjMuNzIgMjEgNDAuMjIgMjFoLS4wMnptMTY5LjgtMTI4LjFjNDMuNSAwIDcwLjUgMzMuOSA3MC41IDc4LjN2Ni42aC0xMTQuNmMyLjEgMjQuNiAyMC4xIDQ1IDQ5LjIgNDUgMTUuMyAwIDMyLjEtNiA0Mi45LTE3LjFsMTIuNiAxNy43Yy0xNC40IDE0LjEtMzQuOCAyMS42LTU4LjIgMjEuNi00My4yIDAtNzUtMzAuNi03NS03Ni4yLjAyLTQyIDMwLjMyLTc1LjkgNzIuNi03NS45em0tNDQuNCA2NS40aDg4LjVjLS42LTE5LjItMTMuNS00My4yLTQ0LjEtNDMuMi0yOS4wOCAwLTQyLjg4IDIzLjQtNDQuMzggNDMuMmgtLjAyem0yNTIuMDIgNjIuNGMtMTAuOCAxNC40LTI4LjIgMjQuMy00Ny40IDI0LjMtMzcuOCAwLTY0LjgtMjguNS02NC44LTc1LjkgMC00Ni41IDI3LTc2LjIgNjQuOC03Ni4yIDE4LjYgMCAzNS43IDkgNDcuNCAyNC42di03Ni4yaDI3djIwMC4xaC0yN3YtMjAuN3ptMC04Mi41Yy03LjUtMTEuNy0yMy43LTIxLjMtNDAuMi0yMS4zLTI3IDAtNDMuOCAyMS45LTQzLjggNTIuMiAwIDMwIDE2LjggNTEuOSA0My44IDUxLjkgMTYuNSAwIDMyLjctOS4zIDQwLjItMjF2LTYxLjh6IgogICAgLz48L2c+PGRlZnM+PGxpbmVhckdyYWRpZW50CiAgICAgIGlkPSJfTGluZWFyMSIKICAgICAgeDE9IjAiCiAgICAgIHgyPSIxIgogICAgICB5MT0iMCIKICAgICAgeTI9IjAiCiAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJyb3RhdGUoLTc0Ljk5OSA2MTQuMTYgNTUuNzU1KSBzY2FsZSgzMDMuOTQpIgogICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgID48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNlZGVkZWQiIC8+PHN0b3AKICAgICAgICBvZmZzZXQ9IjAiCiAgICAgICAgc3RvcC1jb2xvcj0iI2UzZTNlMyIKICAgICAgLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZmYiIC8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQKICAgICAgaWQ9Il9MaW5lYXIyIgogICAgICB4MT0iMCIKICAgICAgeDI9IjEiCiAgICAgIHkxPSIwIgogICAgICB5Mj0iMCIKICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09InJvdGF0ZSg0NSAtNDcwLjg2IDUzMS45NzIpIHNjYWxlKDMwMi41KSIKICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICA+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjZWRlZGVkIiAvPjxzdG9wCiAgICAgICAgb2Zmc2V0PSIwIgogICAgICAgIHN0b3AtY29sb3I9IiNlM2UzZTMiCiAgICAgIC8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjZmZmIiAvPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50CiAgICAgIGlkPSJfTGluZWFyMyIKICAgICAgeDE9IjAiCiAgICAgIHgyPSIxIgogICAgICB5MT0iMCIKICAgICAgeTI9IjAiCiAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLTI5MS4xOSA3OC4wMyAtNzguMDMgLTI5MS4xOSA0NDMuNjIgNDE5Ljk2KSIKICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICA+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjZWRlZGVkIiAvPjxzdG9wCiAgICAgICAgb2Zmc2V0PSIwIgogICAgICAgIHN0b3AtY29sb3I9IiNlM2UzZTMiCiAgICAgIC8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjZmZmIiAvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPgoJCTwvc3ZnPgo="
      />
    </header>

    <div class="grid grid-cols-3 gap-4 p-4 mb-4">
      <product v-for="product in state.products" :product="product" :key="`product-${product.id}`" />
    </div>

    <cart :country-code="state.selectedMarket" />
  </main>
</template>

<script setup lang="ts">
import { reactive, onMounted } from 'vue';
import { useStore } from 'vuex';
import { IMarketOption, IProduct } from './types/products';
import SelectMarket from './components/SelectMarket.vue';
import Product from './components/Product.vue';
import Cart from './components/Cart.vue';

interface IState {
  products: IProduct[];
  marketOptions: IMarketOption[];
  selectedMarket: string;
}

const store = useStore();

const state = reactive<IState>({
  products: [],
  marketOptions: [
    {
      value: 'DE',
      name: 'DE (EUR)',
    },
    {
      value: 'PL',
      name: 'PL (PLN)',
    }
  ],
  selectedMarket: 'DE',
});

const vatRates = () => {
  var requestURL = "https://api.exchangerate.host/vat_rates";
  var request = new XMLHttpRequest();
  request.open("GET", requestURL);
  request.responseType = "json";
  request.send();
  request.onload = function () {
    var response = request.response;
    console.log(response);
  };
};

const exchangeRates = () => {
  var requestURL = "https://api.exchangerate.host/latest";
  var request = new XMLHttpRequest();
  request.open("GET", requestURL);
  request.responseType = "json";
  request.send();
  request.onload = function () {
    var response = request.response;
    console.log(response);
  };
};

onMounted(() => {
  state.products = store.getters.products as IProduct[];
  vatRates();
  exchangeRates();
});
</script>